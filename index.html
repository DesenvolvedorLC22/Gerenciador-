<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Organizador de Estudos</title>
    <style>
        :root {
            --primary-bg: #f4f7f6;
            --secondary-bg: #ffffff;
            --header-bg: #4a5568;
            --accent-color: #4299e1;
            --danger-color: #e53e3e;
            --text-color: #2d3748;
            --border-color: #e2e8f0;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .hidden { display: none !important; }
        body { font-family: var(--font-family); margin: 0; background-color: var(--primary-bg); color: var(--text-color); }
        #auth-container { display: flex; justify-content: center; align-items: center; width: 100vw; height: 100vh; background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%); }
        .auth-card { background-color: var(--secondary-bg); padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; overflow: hidden; }
        .auth-card h2 { text-align: center; margin-top: 0; margin-bottom: 25px; color: var(--header-bg); border: none; }
        .auth-card .form-group { margin-bottom: 20px; }
        .auth-card .auth-button { width: 100%; padding: 12px; font-size: 1.1em; font-weight: bold; border-radius: 5px; border: none; cursor: pointer; background-color: var(--accent-color); color: white; }
        .auth-switch-link, .forgot-password-link { text-align: center; margin-top: 20px; }
        .auth-switch-link a, .forgot-password-link a { color: var(--accent-color); text-decoration: none; font-weight: bold; cursor: pointer; }
        .forgot-password-link { text-align: right; font-size: 0.9em; margin-top: -10px; margin-bottom: 15px; }
        #auth-alert { display: none; padding: 10px; margin-bottom: 15px; border-radius: 5px; text-align: center; font-weight: bold; color: white; }
        #auth-alert.error { background-color: var(--danger-color); }
        #security-question-display { background-color: var(--primary-bg); padding: 10px; border-radius: 4px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="auth-container">
        <div class="auth-card">
            <div id="auth-alert"></div>
            <div id="login-form">
                <h2>Bem-vindo de Volta!</h2>
                <form>
                    <div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" required></div>
                    <div class="form-group"><label for="login-password">Senha</label><input type="password" id="login-password" required></div>
                     <div class="forgot-password-link"><a id="show-forgot-password">Esqueceu sua senha?</a></div>
                    <button type="submit" class="auth-button">Entrar</button>
                    <div class="auth-switch-link">Não tem uma conta? <a id="show-register">Registre-se</a></div>
                </form>
            </div>
            <div id="register-form" class="hidden">
                 <h2>Crie sua Conta</h2>
                <form>
                    <div class="form-group"><label for="register-username">Nome de Usuário</label><input type="text" id="register-username" required></div>
                    <div class="form-group"><label for="register-email">Email</label><input type="email" id="register-email" required></div>
                    <div class="form-group"><label for="register-password">Senha</label><input type="password" id="register-password" required></div>
                    <div class="form-group"><label for="register-sq">Pergunta de Segurança</label><input type="text" id="register-sq" placeholder="Ex: Qual o nome do seu primeiro pet?" required></div>
                    <div class="form-group"><label for="register-sa">Resposta</label><input type="password" id="register-sa" required></div>
                    <button type="submit" class="auth-button">Registrar</button>
                    <div class="auth-switch-link">Já tem uma conta? <a id="show-login-from-register">Entrar</a></div>
                </form>
            </div>
            <div id="forgot-password-flow" class="hidden">
                <h2>Recuperar Senha</h2>
                <form id="forgot-step1-form">
                    <p>Digite seu e-mail para encontrar sua conta.</p>
                    <div class="form-group"><label for="forgot-email">Email</label><input type="email" id="forgot-email" required></div>
                    <button type="submit" class="auth-button">Encontrar Conta</button>
                </form>
                <form id="forgot-step2-form" class="hidden">
                    <p>Responda sua pergunta de segurança.</p>
                    <div id="security-question-display"></div>
                    <div class="form-group"><label for="forgot-sa">Sua Resposta</label><input type="password" id="forgot-sa" required></div>
                    <button type="submit" class="auth-button">Verificar</button>
                </form>
                <form id="forgot-step3-form" class="hidden">
                    <p>Digite sua nova senha.</p>
                    <div class="form-group"><label for="forgot-new-password">Nova Senha</label><input type="password" id="forgot-new-password" required></div>
                     <div class="form-group"><label for="forgot-confirm-password">Confirmar Nova Senha</label><input type="password" id="forgot-confirm-password" required></div>
                    <button type="submit" class="auth-button">Redefinir Senha</button>
                </form>
                 <div class="auth-switch-link"><a class="back-to-login">Voltar ao Login</a></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const USERS_KEY = 'studyAppUsers';
            const CURRENT_USER_KEY = 'studyAppCurrentUser';
            
            // Troque 'app.html' pelo nome exato do seu arquivo principal, se for diferente.
            const APP_FILENAME = 'app.html'; 

            const loginFormEl = document.querySelector('#login-form form');
            const registerFormEl = document.querySelector('#register-form form');
            const forgotStep1Form = document.getElementById('forgot-step1-form');
            const forgotStep2Form = document.getElementById('forgot-step2-form');
            const forgotStep3Form = document.getElementById('forgot-step3-form');
            const authAlert = document.getElementById('auth-alert');
            let userToReset = null;

            if (localStorage.getItem(CURRENT_USER_KEY)) {
                window.location.href = APP_FILENAME;
                return;
            }

            function loadUsers() { return JSON.parse(localStorage.getItem(USERS_KEY)) || []; }
            function saveUsers(users) { localStorage.setItem(USERS_KEY, JSON.stringify(users)); }

            function handleRegister(e) { e.preventDefault(); hideAlert(); const username = document.getElementById('register-username').value; const email = document.getElementById('register-email').value; const password = document.getElementById('register-password').value; const securityQuestion = document.getElementById('register-sq').value; const securityAnswer = document.getElementById('register-sa').value; if (!username || !email || !password || !securityQuestion || !securityAnswer) { showAlert("Todos os campos são obrigatórios."); return; } const users = loadUsers(); if (users.some(u => u.email === email)) { showAlert("Este email já está em uso."); return; } const newUser = { id: Date.now(), username, email, password, securityQuestion, securityAnswer }; users.push(newUser); saveUsers(users); alert("Conta criada com sucesso! Faça o login."); showForm('login-form'); }
            function handleLogin(e) { e.preventDefault(); hideAlert(); const email = document.getElementById('login-email').value; const password = document.getElementById('login-password').value; const users = loadUsers(); const user = users.find(u => u.email === email && u.password === password); if (user) { localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user)); window.location.href = APP_FILENAME; } else { showAlert("Email ou senha inválidos."); } }
            
            forgotStep1Form.addEventListener('submit', (e) => { e.preventDefault(); hideAlert(); const email = document.getElementById('forgot-email').value; const users = loadUsers(); userToReset = users.find(u => u.email === email); if (userToReset) { document.getElementById('security-question-display').textContent = userToReset.securityQuestion; forgotStep1Form.classList.add('hidden'); forgotStep2Form.classList.remove('hidden'); } else { showAlert("Nenhuma conta encontrada com este e-mail."); } });
            forgotStep2Form.addEventListener('submit', (e) => { e.preventDefault(); hideAlert(); const answer = document.getElementById('forgot-sa').value; if (userToReset && answer === userToReset.securityAnswer) { forgotStep2Form.classList.add('hidden'); forgotStep3Form.classList.remove('hidden'); } else { showAlert("Resposta incorreta."); } });
            forgotStep3Form.addEventListener('submit', (e) => { e.preventDefault(); hideAlert(); const newPassword = document.getElementById('forgot-new-password').value; const confirmPassword = document.getElementById('forgot-confirm-password').value; if (newPassword.length < 6) { showAlert("A nova senha deve ter pelo menos 6 caracteres."); return; } if (newPassword !== confirmPassword) { showAlert("As senhas não coincidem."); return; } const users = loadUsers(); const userIndex = users.findIndex(u => u.id === userToReset.id); if (userIndex > -1) { users[userIndex].password = newPassword; saveUsers(users); alert("Senha redefinida com sucesso! Por favor, faça o login com sua nova senha."); userToReset = null; showForm('login-form'); } else { showAlert("Ocorreu um erro. Tente novamente."); } });
            
            function showAlert(message) { authAlert.textContent = message; authAlert.className = 'error'; authAlert.style.display = 'block'; }
            function hideAlert() { authAlert.style.display = 'none'; }
            function showForm(formId) { hideAlert(); document.getElementById('login-form').classList.toggle('hidden', formId !== 'login-form'); document.getElementById('register-form').classList.toggle('hidden', formId !== 'register-form'); document.getElementById('forgot-password-flow').classList.toggle('hidden', formId !== 'forgot-password-flow'); if(formId === 'login-form') { userToReset = null; forgotStep1Form.classList.remove('hidden'); forgotStep2Form.classList.add('hidden'); forgotStep3Form.classList.add('hidden'); forgotStep1Form.reset(); forgotStep2Form.reset(); forgotStep3Form.reset(); } }
            
            registerFormEl.addEventListener('submit', handleRegister);
            loginFormEl.addEventListener('submit', handleLogin);
            document.getElementById('show-register').addEventListener('click', () => showForm('register-form'));
            document.getElementById('show-login-from-register').addEventListener('click', () => showForm('login-form'));
            document.getElementById('show-forgot-password').addEventListener('click', () => showForm('forgot-password-flow'));
            document.querySelectorAll('.back-to-login').forEach(el => el.addEventListener('click', () => showForm('login-form')));
        });
    </script>
</body>
</html>

